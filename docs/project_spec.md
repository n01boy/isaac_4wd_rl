# 4WDロボット機械学習プロジェクト仕様書（Sim-to-Real）

## 1. プロジェクト目的

**仮想空間（Isaac Lab）**で、4輪駆動（4WD）車両がLiDARを用いて障害物を回避し走行するモデルを学習する。
学習済みモデルを Raspberry Pi に移植し、実機で自動走行を実現する。

## 2. システム構成

| 構成要素 | 詳細 |
|---------|------|
| 学習環境 (Cloud) | Google Colab (L4/A100 GPU) |
| シミュレータ | NVIDIA Isaac Lab (Omniverseベース) |
| 制御対象 | 4輪駆動(4WD)車両モデル |
| センサー | 仮想LiDAR (Raycast方式 / 360度スキャン) |
| 実機 (Local) | Raspberry Pi 4/5 + RPLIDAR (または同等品) |

## 3. シミュレーション環境仕様 (10台並列)

- **物理モデル**: 4つの独立した駆動輪を持つ車両。摩擦、慣性、重量を現実のラズパイ車両（約1.5kg〜2kg想定）に合わせる。
- **LiDAR設定**:
  - 分解能：1度刻み（360本）または 10度刻み（36本）。
  - 有効距離：0.15m 〜 12m（実機の性能に合わせる）。
- **並列数**: 10台（デバッグ効率とGUI負荷のバランスを考慮）。

## 4. 強化学習 (RL) パラメータ

- **アルゴリズム**: PPO (Proximal Policy Optimization)
- **観測データ (Observation)**:
  - LiDARのスキャンデータ（距離情報の配列）
  - 現在の車速、角速度
- **行動 (Action)**:
  - 4輪の目標回転速度（$-1.0 \sim 1.0$ の範囲で出力）
- **報酬関数 (Reward)**:
  - $+v \times \Delta t$：前進距離に応じた加点
  - $-100$：衝突時のペナルティ（エピソード終了）
  - $-0.1$：急激なステアリング操作へのペナルティ（滑らかな動きのため）

## 5. Sim-to-Real 移行戦略 (最重要)

実機で動かすために、学習時に以下のDomain Randomization（環境のランダム化）を適用する。

- **LiDARノイズ**: 距離データに $2 \sim 5\%$ のランダムノイズを付与。
- **摩擦係数**: 床の滑りやすさを $0.8 \sim 1.2$ 倍の間で変動させる。
- **遅延シミュレーション**: 指令を出してからモーターが動くまでのラグ（$20 \sim 50ms$）を再現。

## 6. 実機（Raspberry Pi）実装仕様

- **推論エンジン**: ONNX Runtime (Python)
- **通信**: LiDAR → (Python) → 推論モデル → モータードライバー (GPIO)
- **制御周期**: $20Hz$ (50msに1回判断)

## 今後のアクションプラン

- [x] **[クラウド設定]** Google ColabでIsaac Labを起動するスクリプトを準備する。
- [x] **[モデル作成]** 4WD車両の物理データ（タイヤ径や軸間距離）をIsaac Labに入力する。
- [ ] **[学習開始]** まずは「1台」で正しくセンサーが取れているか確認し、その後「10台」に増やす。
